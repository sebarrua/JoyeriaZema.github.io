<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Zema App</title>
  <meta content="" name="description">

  <meta content="" name="keywords">

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: FlexStart - v1.4.0
  * Template URL: https://bootstrapmade.com/flexstart-bootstrap-startup-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
    .panel-body  {
      background:#d8e9f5;
      padding: 10px;
      border-radius: 4px;
      margin: 5px;
    }
  </style>
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span>Joyería Zema</span>
      </a>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="#hero">Inicio</a></li>
          <li><a class="nav-link scrollto" name="products" href="#products">Productos</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="hero d-flex align-items-center">

    <div class="container">
      <div class="row">
        <div class="col-lg-6 d-flex flex-column justify-content-center">
          <h1 data-aos="fade-up">Acceso a datos</h1>
          <h2 data-aos="fade-up" data-aos-delay="400">Ingrese usuario y contraseña de Contabilium para acceder a los datos.</h2>
        </div>
        <div class="col-lg-6 hero-img" data-aos="zoom-out" data-aos-delay="200">
          <div class="row gy-4">
            <div class="col-md-6 ">
              <input type="email" class="form-control" name="email" id="email" placeholder="eMail" >
            </div>
            <div class="col-md-6 ">
              <input type="password" class="form-control" name="pasword" id="password" placeholder="Password" >
            </div>
            <div class="col-md-12">
              <textarea readonly class="form-control" name="message" id="token" rows="6" placeholder="Token"></textarea>
            </div>
            <div class="col-md">
              <button onclick="Token()">Conseguir token</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section><!-- End Hero -->
  <section id="products" class="hero d-flex">
    <div class="container">
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#agregarProducto">Agregar +</button>
          <button type="button" class="btn btn-success" onclick="Update()">Actualizar</button>
          <!--<button type="button" class="btn btn-warning" onclick="Token1()">Token1</button>-->
          </br>
          </br>
          <!-- Modal -->
          <div class="modal fade bd-example-modal-lg" id="agregarProducto" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" width="80%">
            <div class="modal-dialog modal-lg" role="document" max-width="1200px;">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="exampleModalLabel">Agregar Concepto</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="panel-body shadow-sm">
                    <div class="modal-header">                  
                      <h5 class="modal-title" id="exampleModalLabel">Datos obligatorios</h5>
                      <small class="form-text text-muted">(*) datos obligatorios para agregar el nuevo concepto</small>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Codigo</small>
                          <input type="number" class="form-control" name="Codigo" id="Codigo" placeholder="Codigo" >
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Nombre</small>
                          <input type="text" class="form-control" name="Nombre" id="Nombre" placeholder="Nombre" >
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Tipo</small>
                          <input type="text" class="form-control" name="Tipo" id="Tipo" placeholder="Tipo" >
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Precio</small>
                          <input type="text" class="form-control" name="Precio" id="Precio" placeholder="Precio" aria-label="Amount (to the nearest dollar)">
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Iva</small>
                          <input type="text" class="form-control" name="Iva" id="Iva" placeholder="Iva" >
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*Estado</small>
                          <input type="text" class="form-control" name="Estado" id="Estado" placeholder="Estado" >
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">*IDRubro</small>
                          <input type="text" class="form-control" name="IDRubro" id="IDRubro" placeholder="IDRubro" >
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <small id="emailHelp" class="form-text text-muted">CodigoBarras</small>
                          <input type="text" class="form-control" name="CodigoBarras" id="CodigoBarras" placeholder="CodigoBarras" >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-primary" onclick="AddProducto()">Guardar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <table id="tbl_entidad" class="display nowrap" style="width:100%"></table>
        </div>
      </div>
    </div>
  </section>
<!--  <main id="main">
</main> End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">

    <div class="footer-newsletter">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-12 text-center">
            <h4>Desarrollado X</h4>
            <p>Desarrollador mayormente autodidacta con experiencia comprobable.</p>
            <p><a href="mailto:arrua.sebastian@gmail.com">arrua.sebastian@gmail.com</a></p>
            <p><a href="https://www.linkedin.com/in/sebastian-arrua-24a72a148/">Linkedin</a></p>
            <p><a href="https://api.whatsapp.com/send?phone=5493751441285">WhatsApp</a></p>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>sarrua</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/flexstart-bootstrap-startup-template/ -->
        Designed by <a href="https://bootstrap.com/">Bootstrap</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <!-- Template Main JS File <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
  <script src="assets/js/main.js"></script>

  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
	<script>
    /*
    $('#agregarProducto').on('shown.bs.modal', function () {
      $('#myInput').trigger('focus')
    })
    */
		$(document).ready(function(){
      var token='';
      var jsonObject = [];
      cargarTablaProductos(jsonObject);
		});

    function cargarTablaProductos(jsonObject){
			$('#tbl_entidad').dataTable( {
     		data : jsonObject,
        columnDefs: [
          { responsivePriority: 1, "name": "Codigo","title": "Codigo",   "targets": 0 },
          { responsivePriority: 2,"name": "Nombre", "title": "Nombre",  "targets": 1 },
          { "name": "Descripcion", "title": "Descripcion", "targets": 2 },
          { responsivePriority: 3,"name": "Precio", "title": "Precio",  "targets": 3 },
          { "name": "Stock", "title": "Stock",    "targets": 4 },
          { "name": "Producto", "title": "Producto",   "targets": 5 },
          { "name": "CodigoOem", "title": "CodigoOem",  "targets": 6 },
          { "name": "CodigoBarras", "title": "CodigoBarras", "targets": 7 }
        ],
        columns: [
			    {"data" : "Codigo", "defaultContent": "<i>Not set</i>"},
          {"data" : "Nombre", "defaultContent": "<i>Not set</i>"},
			    {"data" : "Descripcion", "defaultContent": "<i>Not set</i>"},
          {"data" : "Precio", "defaultContent": "<i>Not set</i>"},
          {"data" : "Stock", "defaultContent": "<i>Not set</i>"},
			    {"data" : "Producto", "defaultContent": "<i>Not set</i>"},
          {"data" : "CodigoOem", "defaultContent": "<i>Not set</i>"},
          {"data" : "CodigoBarras", "defaultContent": "<i>Not set</i>"}
		    ],
        responsive: true
        
			});
		};
/*
    function Token1(){
      var client_id = "";
      var client_secret = "";
			$.ajax({
				url:"https://rest.contabilium.com/token",
				type:"POST",
				data:{
					"grant_type": "client_credentials",
					"client_id": client_id,
					"client_secret": client_secret
				},
				success:function(responseToken) {
					//document.getElementById("total_items").value=response;
					//alert(response.data);
					token=responseToken.access_token;
          $("#token").css("color", "#52be80");
					document.getElementById("token").value = responseToken.access_token;
          Update();
          const demoClasses = document.querySelectorAll('.nav-link');
          demoClasses.forEach(element => {
            element.setAttribute('class', '.nav-link');
            element.classList.add('scrollto');
            //$(".nav-link li.active").removeClass("active");
            //element.getElementsByName('products').classList.add('active');
          });
					//return response.access_token;
				},
				error:function(responseToken){
          $("#token").css("color", "#ef3d3d");
					document.getElementById("token").value = "Error: datos de acceso incorrectos.";
				}
			});
		};
*/
    function Token(){
      var client_id = document.getElementById("email").value;
      var client_secret = document.getElementById("password").value;
			$.ajax({
				url:"https://rest.contabilium.com/token",
				type:"POST",
				data:{
					"grant_type": "client_credentials",
					"client_id": client_id,
					"client_secret": client_secret
				},
				success:function(responseToken) {
					//document.getElementById("total_items").value=response;
					//alert(response.data);
					token=responseToken.access_token;
          $("#token").css("color", "#52be80");
					document.getElementById("token").value = responseToken.access_token;
          Update();
          const demoClasses = document.querySelectorAll('.nav-link');
          demoClasses.forEach(element => {
            element.setAttribute('class', '.nav-link');
            element.classList.add('scrollto');
            //$(".nav-link li.active").removeClass("active");
            //element.getElementsByName('products').classList.add('active');
          });
          const pro = document.getElementsByName('products');
          pro.classList.add('active');
					//return response.access_token;
				},
				error:function(responseToken){
          $("#token").css("color", "#ef3d3d");
					document.getElementById("token").value = "Error: datos de acceso incorrectos.";
				}
			});
		};

    function AddProducto(){
      var nombrePro = document.getElementById("Nombre").value;
      var tipoPro = document.getElementById("Tipo").value;
      var codigoPro = document.getElementById("Codigo").value;
      var precioPro = document.getElementById("Precio").value;
      var ivaPro = document.getElementById("Iva").value;
      var estadoPro = document.getElementById("Estado").value;
      var idRubroPro = document.getElementById("IDRubro").value;
      var codigoBarrasPro = document.getElementById("CodigoBarras").value;
      $.ajax({
				url:"https://rest.contabilium.com/api/conceptos/",
				type:"POST",
				headers: {
          'Authorization': 'Bearer '+token,
          'Content-Type':'application/json',
        },
        
        data: JSON.stringify({
          "nombre": nombrePro,
          "Tipo": "P",
          "Codigo": codigoPro,
          "CodigoOem": "",
          "CodigoBarras": codigoBarrasPro,
          "Descripcion": "Descripcion concepto api POST",
          "Precio": precioPro,
          "Iva": 21,
          "Rentabilidad": 0,
          "Stock": 0,
          "StockMinimo":1,
          "Observaciones": "Observaciones concepto api",
          "Estado": "A",
          "IdRubro": "92327"
        }),
        success(data, text) {
          console.log(data);
          Update();
        },
        error(request, status, error) {
          console.log(error)
        }
			});
    }

    function Update(){
      if(token.value==''){
        $("#token").css("color", "#ef3d3d");
					document.getElementById("token").value = "Error: por favor ingrese usuario y contraseña de Contabilium.";
      }else{
        $("#tbl_entidad").dataTable().fnDestroy();
        Productos();
      }
    };

		function Productos(){
			var prodList;
			$.ajax({
				url: 'https://rest.contabilium.com/api/conceptos/search?pageSize=0',
				type: 'GET',
				headers: {
          'Authorization': 'Bearer '+token,
          'Content-Type':'application/json',
        },
				success:function(responsePro) {
					prodList = responsePro.Items;
					cargarTablaProductos(prodList);
				},
				error:function(){
					alert("errorProductos");
				}
			});
		};
	</script>
</body>

</html>